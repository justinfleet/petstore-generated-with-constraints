workflows:
  # Happy Path Tests
  - name: customer_login_and_browse_pets
    description: Customer logs in and browses available pets
    category: happy_path
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "GET /api/v3/pet/findByStatus"
        description: Browse available pets
        query:
          status: available
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200

      - action: "GET /api/v3/pet/{{available_pet_id}}"
        description: View specific pet details
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            id: 1

  - name: successful_order_placement_flow
    description: Customer places an order (uses pet 2 to avoid conflicts)
    category: happy_path
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "POST /api/v3/store/order"
        description: Place order for pet 2 (available)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          petId: 2
          quantity: 1
          shipDate: "2024-01-15T10:00:00Z"
        expect:
          status: 201
          body_contains:
            petId: 2
            status: "placed"

  - name: store_owner_approves_and_delivers_order
    description: Store owner approves and delivers order 1 (from seed data)
    category: happy_path
    steps:
      - action: "GET /api/v3/user/login"
        description: Store owner logs in
        query:
          username: "{{store_owner_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "PUT /api/v3/store/order/1"
        description: Approve order 1 (exists in seed data)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          status: "approved"
        expect:
          status: 200

      - action: "PUT /api/v3/store/order/1"
        description: Mark order as delivered
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          status: "delivered"
          complete: true
        expect:
          status: 200

      - action: "GET /api/v3/pet/5"
        description: Verify pet 5 status changed to sold
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            status: "sold"

  # Authorization Tests
  - name: customer_cannot_access_store_owner_endpoints
    description: Customer cannot create, update, or delete pets
    category: authorization
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "POST /api/v3/pet"
        description: Try to create a pet (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          name: "TestPet"
          status: "available"
        expect:
          status: 403

      - action: "DELETE /api/v3/pet/1"
        description: Try to delete a pet (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 403

      - action: "GET /api/v3/store/inventory"
        description: Try to view inventory (should fail for customer)
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 403

  - name: guest_cannot_access_authenticated_endpoints
    description: Unauthenticated requests are denied
    category: authorization
    steps:
      - action: "GET /api/v3/pet/findByStatus"
        description: Try to browse pets without auth
        query:
          status: available
        expect:
          status: 401

      - action: "POST /api/v3/store/order"
        description: Try to place order without auth
        body:
          petId: 1
          quantity: 1
        expect:
          status: 401

      - action: "GET /api/v3/user/customer1"
        description: Try to view user profile without auth
        expect:
          status: 401

  - name: customer_can_only_view_own_orders
    description: Customer can view own orders but not others
    category: authorization
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer1 logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "GET /api/v3/store/order/2"
        description: Try to view order 2 (belongs to customer2, should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 403

  # Validation Tests
  - name: cannot_order_unavailable_pet
    description: Cannot order a pet that is not available
    category: validation
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "POST /api/v3/store/order"
        description: Try to order pending pet 5 (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          petId: 5
          quantity: 1
        expect:
          status: 400
          body_contains:
            error: "Pet is not available for purchase"

  - name: order_quantity_must_be_one
    description: Order quantity must be exactly 1
    category: validation
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "POST /api/v3/store/order"
        description: Try to order quantity > 1 (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          petId: 3
          quantity: 5
        expect:
          status: 400

      - action: "POST /api/v3/store/order"
        description: Try to order quantity = 0 (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          petId: 3
          quantity: 0
        expect:
          status: 400

  - name: cannot_order_pet_with_active_order
    description: Cannot order a pet that already has an active order
    category: validation
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "POST /api/v3/store/order"
        description: Try to order pet 5 which has order 1 (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          petId: 5
          quantity: 1
        expect:
          status: 400

  # State Transition Tests
  - name: order_creation_changes_pet_to_pending
    description: Placing an order changes pet status to pending
    category: state_transition
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "GET /api/v3/pet/3"
        description: Verify pet 3 is available
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            status: "available"

      - action: "POST /api/v3/store/order"
        description: Place order for pet 3
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          petId: 3
          quantity: 1
        expect:
          status: 201
          body_contains:
            id: "{{save:order_id}}"

      - action: "GET /api/v3/pet/3"
        description: Verify pet status changed to pending
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            status: "pending"

  - name: order_delivery_changes_pet_to_sold
    description: Delivering an order changes pet to sold
    category: state_transition
    steps:
      - action: "GET /api/v3/user/login"
        description: Store owner logs in
        query:
          username: "{{store_owner_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "GET /api/v3/pet/5"
        description: Verify pet 5 is pending (has order 1)
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            status: "pending"

      - action: "PUT /api/v3/store/order/1"
        description: Approve order 1
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          status: "approved"
        expect:
          status: 200

      - action: "PUT /api/v3/store/order/1"
        description: Deliver order 1
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          status: "delivered"
          complete: true
        expect:
          status: 200

      - action: "GET /api/v3/pet/5"
        description: Verify pet 5 is now sold
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            status: "sold"

  - name: order_cancellation_returns_pet_to_available
    description: Cancelling an order returns pet to available
    category: state_transition
    steps:
      - action: "GET /api/v3/user/login"
        description: Customer logs in
        query:
          username: "{{customer_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "POST /api/v3/store/order"
        description: Place order for pet 4
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          petId: 4
          quantity: 1
        expect:
          status: 201
          body_contains:
            id: "{{save:order_id}}"

      - action: "GET /api/v3/pet/4"
        description: Verify pet 4 is now pending
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            status: "pending"

      - action: "DELETE /api/v3/store/order/{{order_id}}"
        description: Cancel the order
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200

      - action: "GET /api/v3/pet/4"
        description: Verify pet returned to available
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 200
          body_contains:
            status: "available"

  # Error Handling Tests
  - name: cannot_delete_pet_with_active_orders
    description: Cannot delete a pet that has active orders
    category: error_handling
    steps:
      - action: "GET /api/v3/user/login"
        description: Store owner logs in
        query:
          username: "{{store_owner_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "DELETE /api/v3/pet/5"
        description: Try to delete pet 5 which has order 1 (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        expect:
          status: 400

  - name: cannot_modify_delivered_orders
    description: Cannot modify orders that have been delivered
    category: error_handling
    steps:
      - action: "GET /api/v3/user/login"
        description: Store owner logs in
        query:
          username: "{{store_owner_username}}"
          password: "{{test_password}}"
        expect:
          status: 200
          body_contains:
            token: "{{save:auth_token}}"

      - action: "PUT /api/v3/store/order/2"
        description: Try to modify delivered order 2 (should fail)
        headers:
          Authorization: "Bearer {{auth_token}}"
        body:
          status: "approved"
        expect:
          status: 400
